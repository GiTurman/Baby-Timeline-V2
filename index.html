<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIDDO - áƒªáƒ®áƒáƒ•áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Sans+Condensed:ital,wght@0,400;0,700;1,400&display=swap');
        
        body { background-color: #fdfaf3; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #3d2b1f; }
        .book-card { background: white; border-radius: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.03); border: 1px solid rgba(255,255,255,0.6); }
        
        /* Drop Cap - áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒ“áƒ˜áƒ“áƒ˜ áƒáƒ¡áƒ áƒ¬áƒ˜áƒ’áƒœáƒ˜áƒ¡ áƒ¡áƒ¢áƒ˜áƒšáƒ¨áƒ˜ */
        .story-text::first-letter {
            float: left;
            font-size: 5rem;
            line-height: 0.8;
            padding-top: 8px;
            padding-right: 12px;
            font-weight: bold;
            color: #fb923c; /* áƒœáƒáƒ áƒ˜áƒœáƒ¯áƒ˜áƒ¡áƒ¤áƒ”áƒ áƒ˜ */
        }
        
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #fb923c; width: 24px; height: 24px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-6 md:p-12">
    <div class="max-w-2xl mx-auto">
        
        <header class="text-center mb-16">
            <h1 class="text-5xl font-bold text-orange-950 tracking-tighter mb-2">KIDDO</h1>
            <p class="text-orange-600 italic font-medium">áƒ©áƒ•áƒ”áƒœáƒ˜ áƒ“áƒ˜áƒ“áƒ˜ áƒ—áƒáƒ•áƒ’áƒáƒ“áƒáƒ¡áƒáƒ•áƒáƒšáƒ˜ â€¢ Gemini 3</p>
        </header>

        <div class="book-card p-10 mb-20 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-200 to-pink-200"></div>
            
            <textarea id="userNote" class="w-full border-none focus:ring-0 text-2xl placeholder-orange-100 h-32 outline-none bg-transparent resize-none mb-6" placeholder="áƒáƒ¦áƒ¬áƒ”áƒ áƒ” áƒ“áƒ¦áƒ”áƒ•áƒáƒœáƒ“áƒ”áƒšáƒ˜ áƒ“áƒ¦áƒ” áƒ›áƒáƒ™áƒšáƒ”áƒ“..."></textarea>
            
            <div id="imgPreviewContainer" class="hidden mb-8 relative group">
                <button onclick="clearImg()" class="absolute top-4 right-4 bg-black/50 text-white w-10 h-10 rounded-full backdrop-blur-sm z-10">âœ•</button>
                <img id="previewImg" src="" class="w-full h-64 object-cover rounded-[30px] shadow-lg">
            </div>

            <div class="flex flex-col gap-6">
                <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="handleFile(this)">
                <button onclick="document.getElementById('fileInput').click()" class="flex items-center gap-2 text-orange-800 font-bold border-b-2 border-orange-50 w-max pb-1 hover:border-orange-200 transition">
                    ğŸ–¼ï¸ áƒ¤áƒáƒ¢áƒáƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ
                </button>
                
                <button id="mainBtn" onclick="generateStory()" class="bg-gradient-to-r from-orange-400 to-pink-400 text-white font-bold py-6 rounded-[25px] shadow-2xl hover:scale-[1.02] active:scale-95 transition-all text-xl flex items-center justify-center gap-4">
                    <span id="btnText">áƒ©áƒáƒ¬áƒ”áƒ áƒ” áƒ¬áƒ˜áƒ’áƒœáƒ¨áƒ˜ âœ¨</span>
                    <div id="loader" class="loader"></div>
                </button>
            </div>
        </div>

        <div id="timeline" class="space-y-16">
            </div>
    </div>

    <script>
        const API_KEY = "AIzaSyDm5B64HwQ43WtoNiPEWluf0lDY75918HY";
        let currentImageData = null;

        function handleFile(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentImageData = e.target.result;
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imgPreviewContainer').classList.remove('hidden');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function clearImg() {
            currentImageData = null;
            document.getElementById('imgPreviewContainer').classList.add('hidden');
            document.getElementById('fileInput').value = "";
        }

        async function generateStory() {
            const note = document.getElementById('userNote').value;
            const btnText = document.getElementById('btnText');
            const loader = document.getElementById('loader');

            if (!note) return alert("áƒ’áƒ—áƒ®áƒáƒ•áƒ—, áƒ“áƒáƒ¬áƒ”áƒ áƒáƒ— áƒ áƒáƒ˜áƒ›áƒ” áƒ›áƒáƒ›áƒ”áƒœáƒ¢áƒ˜...");

            btnText.innerText = "KIDDO áƒ¬áƒ”áƒ áƒ¡ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒáƒ¡...";
            loader.style.display = "block";

            try {
                // Gemini 3-áƒ˜áƒ¡ áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ áƒ•áƒ áƒªáƒ”áƒšáƒ˜ áƒ“áƒ áƒ”áƒ›áƒáƒªáƒ˜áƒ£áƒ áƒ˜ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ 
                            parts: [{ 
                                text: `áƒ¨áƒ”áƒœ áƒ®áƒáƒ  áƒáƒ áƒáƒ¤áƒ”áƒ¡áƒ˜áƒáƒœáƒáƒšáƒ˜ áƒ›áƒ¬áƒ”áƒ áƒáƒšáƒ˜, áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ›áƒ¨áƒáƒ‘áƒšáƒ˜áƒ¡ áƒ”áƒ›áƒáƒªáƒ˜áƒ”áƒ‘áƒ¡ áƒ¨áƒ•áƒ˜áƒšáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ¬áƒ”áƒ áƒ˜áƒšáƒ”áƒ‘áƒáƒ“ áƒáƒ¥áƒªáƒ”áƒ•áƒ¡. áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ›áƒ áƒ›áƒáƒ’áƒªáƒ áƒ”áƒ¡ áƒ›áƒáƒ™áƒšáƒ” áƒ¤áƒ áƒáƒ–áƒ: "${note}". áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ•áƒ áƒªáƒ”áƒšáƒ˜ (200-300 áƒ¡áƒ˜áƒ¢áƒ§áƒ•áƒ), áƒ«áƒáƒšáƒ˜áƒáƒœ áƒ”áƒ›áƒáƒªáƒ˜áƒ£áƒ áƒ˜, áƒ—áƒ‘áƒ˜áƒšáƒ˜ áƒ“áƒ áƒáƒáƒ”áƒ¢áƒ£áƒ áƒ˜ áƒ¬áƒ”áƒ áƒ˜áƒšáƒ˜ áƒ¥áƒáƒ áƒ—áƒ£áƒš áƒ”áƒœáƒáƒ–áƒ”. áƒ˜áƒ¡áƒáƒ£áƒ‘áƒ áƒ” áƒ˜áƒ›áƒáƒ–áƒ”, áƒ—áƒ£ áƒ áƒáƒ¡ áƒ’áƒ áƒ«áƒœáƒáƒ‘áƒ¡ áƒ›áƒ¨áƒáƒ‘áƒ”áƒšáƒ˜, áƒ áƒáƒ’áƒáƒ  áƒ¨áƒ”áƒªáƒ•áƒáƒšáƒ áƒáƒ› áƒ¬áƒáƒ›áƒ›áƒ áƒ¡áƒáƒ›áƒ§áƒáƒ áƒ áƒ“áƒ áƒ áƒ áƒ‘áƒ”áƒ“áƒœáƒ˜áƒ”áƒ áƒ”áƒ‘áƒáƒ áƒ”áƒ¡ áƒ›áƒáƒ›áƒ”áƒœáƒ¢áƒ˜. áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ áƒ˜áƒ¡áƒ”áƒ—áƒ˜, áƒ áƒáƒ› áƒ¬áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’ áƒ¬áƒáƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ¡áƒáƒ¡ áƒáƒáƒ¢áƒ˜áƒ áƒáƒ¡ áƒáƒ“áƒáƒ›áƒ˜áƒáƒœáƒ˜ áƒ¡áƒ˜áƒ®áƒáƒ áƒ£áƒšáƒ˜áƒ—.` 
                            }] 
                        }]
                    })
                });

                const data = await response.json();
                const aiStory = data.candidates[0].content.parts[0].text;

                addStoryToUI(aiStory, currentImageData);

                // áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ
                document.getElementById('userNote').value = "";
                clearImg();

            } catch (error) {
                alert("áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: AI-áƒ¡áƒ—áƒáƒœ áƒ“áƒáƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ”áƒ‘áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ.");
                console.error(error);
            } finally {
                btnText.innerText = "áƒ©áƒáƒ¬áƒ”áƒ áƒ” áƒ¬áƒ˜áƒ’áƒœáƒ¨áƒ˜ âœ¨";
                loader.style.display = "none";
            }
        }

        function addStoryToUI(story, img) {
            const timeline = document.getElementById('timeline');
            const date = new Date().toLocaleDateString('ka-GE', { day: 'numeric', month: 'long', year: 'numeric' });
            
            const html = `
                <div class="book-card p-10 animate-fade-in border-l-[12px] border-orange-400">
                    <div class="flex justify-between items-center mb-8">
                        <span class="bg-orange-50 text-orange-600 text-xs font-bold px-4 py-2 rounded-full uppercase tracking-widest">${date}</span>
                    </div>
                    
                    ${img ? `<img src="${img}" class="w-full h-80 object-cover rounded-[35px] mb-8 shadow-md">` : ''}
                    
                    <div class="story-text text-orange-950 text-2xl leading-[1.8] font-serif italic whitespace-pre-line">
                        ${
